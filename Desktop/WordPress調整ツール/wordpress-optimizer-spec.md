# WordPress記事最適化提案アプリケーション仕様書

## 1. プロジェクト概要

### 1.1 目的
WordPressサイトの既存コンテンツを分析し、ユーザー自身のGemini APIキーを使用してAIによる最適な記事提案を行い、直接投稿まで可能なWebアプリケーション

### 1.2 主要機能
- WordPress REST APIを使用したサイト分析
- ユーザー提供のGemini APIキーによる記事最適化提案
- 記事の作成・編集・投稿機能
- 記事管理機能（CRUD操作）
- 設定のローカル保存/エクスポート・インポート機能

### 1.3 技術スタック
- **フロントエンド**: React.js + TypeScript
- **バックエンド**: Firebase Functions (Node.js) - 最小限の利用
- **データ保存**: 
  - ローカルストレージ（設定情報）
  - Firestore（記事データのバックアップ - オプション）
- **ホスティング**: Firebase Hosting
- **AI**: Google Gemini 2.5 Pro/Flash API（ユーザー提供）
- **外部API**: WordPress REST API

## 2. 機能要件

### 2.1 初期設定機能

#### 2.1.1 APIキー設定
**Gemini API設定:**
- APIキー入力フィールド
- APIキー検証機能
- 使用モデル選択（Pro/Flash）
- APIキー暗号化してローカル保存

**セキュリティ注意事項表示:**
- APIキーの取り扱い注意
- ブラウザ保存のリスク説明
- プライベートブラウジングでの使用推奨

#### 2.1.2 設定管理
- 設定のエクスポート（JSON形式）
- 設定のインポート
- 設定のリセット機能
- 複数プロファイル管理（ローカル保存）

### 2.2 WordPressサイト接続機能

#### 2.2.1 サイト登録
**入力項目:**
- サイトURL
- REST APIエンドポイント（自動検出）
- 認証方法選択：
  - Application Passwords（推奨）
  - Basic認証
  - カスタムヘッダー認証
- 認証情報

**接続テスト:**
- REST API疎通確認
- 権限確認（読み取り・書き込み）
- エンドポイント一覧取得

#### 2.2.2 複数サイト管理
- サイトプロファイル保存（ローカル）
- サイト切り替え機能
- サイト設定の編集・削除
- 最大5サイトまで登録可能

### 2.3 サイト分析機能

#### 2.3.1 データ取得
**取得項目:**
- カテゴリー構造（階層含む）
- タグ一覧
- 直近の投稿記事（件数指定可能：10-100件）
  - タイトル
  - メタディスクリプション（Yoast SEO/All in One SEO対応）
  - カテゴリー・タグ
  - 公開日時
  - 文字数
  - カスタムフィールド（オプション）

#### 2.3.2 分析キャッシュ
- 分析結果の一時保存（セッション中）
- 手動更新ボタン
- 最終更新日時表示

### 2.4 コンテンツ入力機能

#### 2.4.1 入力方法
**テキスト入力:**
- プレーンテキストエリア
- Markdownエディタ
- リッチテキストエディタ（オプション）
- 文字数カウント（リアルタイム）

**ファイルアップロード:**
- 対応形式：.txt, .md, .docx, .pdf
- 最大サイズ：5MB
- ドラッグ&ドロップ対応
- クライアントサイドでのファイル処理

#### 2.4.2 入力テンプレート
- よく使うテンプレートの保存（ローカル）
- テンプレート管理（追加・編集・削除）
- デフォルトテンプレート提供

### 2.5 AI提案機能

#### 2.5.1 提案内容
**記事タイトル:**
- 3-5パターン生成
- 文字数指定（推奨32文字以内）
- SEOキーワード考慮

**カテゴリー・タグ:**
- 既存カテゴリーから最適選択
- 新規カテゴリー・タグ提案
- 関連度スコア表示

**記事構成:**
- 見出し構成案（H2-H4）
- 各セクションの概要
- 推奨文字数

**メタディスクリプション:**
- 120-160文字
- キーワード最適化
- 複数パターン生成

**本文生成（オプション）:**
- セクション単位での生成
- トーン設定可能
- 文字数指定

#### 2.5.2 プロンプト設定
**カスタマイズ可能項目:**
- システムプロンプト編集
- トーン（formal/casual/professional）
- ターゲット読者層
- SEO重視度
- 記事の目的（情報提供/問題解決/エンタメ等）

**プロンプトテンプレート:**
- デフォルトテンプレート提供
- カスタムテンプレート保存
- テンプレート共有機能（エクスポート）

#### 2.5.3 API使用量管理
- リクエスト回数カウント（セッション/日/月）
- トークン使用量表示
- 推定コスト表示
- 使用量アラート設定

### 2.6 記事編集機能

#### 2.6.1 エディタ
**基本機能:**
- ビジュアルエディタ（TinyMCE）
- HTMLエディタ
- Markdownエディタ
- エディタ切り替え

**編集機能:**
- AI提案の選択採用
- インライン編集
- 一括置換
- 元に戻す/やり直し

#### 2.6.2 プレビュー
- リアルタイムプレビュー
- WordPress テーマ適用プレビュー（近似）
- モバイル/デスクトップ表示切り替え
- SEOプレビュー（検索結果表示）

### 2.7 投稿機能

#### 2.7.1 投稿設定
**公開オプション:**
- 下書き保存
- レビュー待ち
- 即時公開
- 予約投稿

**投稿詳細設定:**
- パーマリンク
- アイキャッチ画像（メディアライブラリから選択）
- 抜粋
- コメント設定
- カスタムフィールド（対応している場合）

#### 2.7.2 投稿前チェック
- 必須項目確認
- 文字数確認
- 画像alt属性チェック
- 内部リンクチェック

### 2.8 記事管理機能

#### 2.8.1 ローカル下書き管理
**保存機能:**
- ブラウザ内での下書き保存
- 自動保存（1分ごと）
- 手動保存
- 保存容量制限（localStorage 5-10MB）

**管理機能:**
- 下書き一覧
- 検索・フィルタ
- 並び替え
- 一括削除

#### 2.8.2 WordPress記事管理
**取得・表示:**
- 投稿済み記事一覧
- ステータス別表示
- ページネーション

**操作:**
- 記事の編集（アプリ内で編集して再投稿）
- 下書きに戻す
- 削除（ゴミ箱へ）
- 複製して新規作成

### 2.9 ユーティリティ機能

#### 2.9.1 バックアップ・復元
- 全設定のエクスポート
- 下書きのエクスポート（JSON/Markdown）
- インポート機能
- Google Drive連携（オプション）

#### 2.9.2 使用統計
- API使用回数グラフ
- 記事作成数
- よく使うカテゴリー・タグ
- 月別統計

## 3. 非機能要件

### 3.1 パフォーマンス
- 初回ロード：3秒以内
- API応答待機中のローディング表示
- 大量テキスト処理の最適化
- Web Worker活用（重い処理）

### 3.2 セキュリティ
- APIキーのクライアントサイド暗号化
- CORS対応
- XSS対策
- Content Security Policy設定
- HTTPSでのホスティング必須

### 3.3 ブラウザ対応
- Chrome（最新2バージョン）
- Firefox（最新2バージョン）
- Safari（最新2バージョン）
- Edge（最新2バージョン）

### 3.4 ユーザビリティ
- レスポンシブデザイン（タブレット対応まで）
- キーボードショートカット
- ツールチップ・ヘルプ表示
- 日本語UI
- ダークモード対応

## 4. データ管理

### 4.1 ローカルストレージ構造

```javascript
// 設定情報
localStorage.setItem('wp_optimizer_config', {
  geminiApiKey: "encrypted_key",
  selectedModel: "gemini-2.5-pro",
  sites: [
    {
      id: "site_1",
      url: "https://example.com",
      apiEndpoint: "https://example.com/wp-json/wp/v2",
      authType: "application_passwords",
      credentials: "encrypted_credentials"
    }
  ],
  currentSiteId: "site_1",
  prompts: {
    system: "カスタムシステムプロンプト",
    templates: []
  }
});

// 下書き記事
localStorage.setItem('wp_optimizer_drafts', [
  {
    id: "draft_1",
    title: "記事タイトル",
    content: "記事本文",
    categories: [],
    tags: [],
    metaDescription: "",
    createdAt: "2024-01-01T00:00:00Z",
    updatedAt: "2024-01-01T00:00:00Z",
    siteId: "site_1"
  }
]);

// 使用統計
localStorage.setItem('wp_optimizer_stats', {
  apiCalls: {
    daily: {},
    monthly: {}
  },
  articlesCreated: 0,
  lastUsed: "2024-01-01T00:00:00Z"
});
```

### 4.2 セッションストレージ

```javascript
// 一時的な分析データ
sessionStorage.setItem('site_analysis_cache', {
  siteId: "site_1",
  categories: [],
  tags: [],
  recentPosts: [],
  analyzedAt: "2024-01-01T00:00:00Z"
});

// 作業中のデータ
sessionStorage.setItem('current_work', {
  input: "入力テキスト",
  suggestions: {},
  editorContent: ""
});
```

## 5. 画面設計

### 5.1 メイン画面構成

#### 5.1.1 ヘッダー
- アプリロゴ・タイトル
- サイト選択ドロップダウン
- 設定ボタン
- ヘルプボタン

#### 5.1.2 サイドバー（折りたたみ可能）
- ナビゲーションメニュー
  - 新規作成
  - 下書き一覧
  - WordPress記事管理
  - 統計
  - 設定
- サイト分析情報サマリー

#### 5.1.3 メインコンテンツエリア
- タブ切り替え（入力/AI提案/編集/プレビュー）
- 各機能の表示エリア

### 5.2 レスポンシブ対応
- デスクトップ：3カラムレイアウト
- タブレット：2カラムレイアウト
- モバイル：非対応（デスクトップ推奨の案内表示）

## 6. 開発フェーズ

### Phase 1：基盤構築（1週間）
- React プロジェクトセットアップ
- Firebase Hosting設定
- 基本UIコンポーネント作成
- ローカルストレージ管理

### Phase 2：API連携（2週間）
- Gemini API接続
- WordPress REST API接続
- 認証機能実装
- エラーハンドリング

### Phase 3：コア機能（2週間）
- サイト分析機能
- AI提案機能
- プロンプトエンジニアリング
- 提案結果表示

### Phase 4：編集・投稿（2週間）
- エディタ実装
- プレビュー機能
- WordPress投稿機能
- 下書き管理

### Phase 5：仕上げ（1週間）
- UI/UX改善
- パフォーマンス最適化
- テスト
- ドキュメント作成

## 7. 制限事項・注意点

### 7.1 技術的制限
- ブラウザのローカルストレージ容量制限（5-10MB）
- クライアントサイドでのAPIキー管理のセキュリティリスク
- CORS制限があるWordPressサイトは接続不可
- 大量データ処理時のブラウザメモリ制限

### 7.2 機能制限
- WordPress 5.0以上、REST API有効化必須
- 一部のセキュリティプラグインとの非互換
- カスタムブロック（Gutenberg）の完全サポートは困難
- メディアアップロードは既存メディアライブラリからの選択のみ

### 7.3 推奨事項
- プライベートブラウジングモードでの使用
- 定期的な設定バックアップ
- APIキーの定期更新
- 重要な記事は投稿前にWordPress管理画面で最終確認

## 8. 今後の拡張可能性

- ブラウザ拡張機能版の開発
- デスクトップアプリ版（Electron）
- 他のAI API対応（Claude, GPT-4等）
- チーム共有機能（別途サーバー必要）
- プラグイン化（WordPress管理画面内で動作）
- 画像生成AI連携

## 9. ドキュメント・サポート

### 9.1 提供ドキュメント
- セットアップガイド
- Gemini APIキー取得手順
- WordPress設定手順
- よくある質問（FAQ）
- トラブルシューティング

### 9.2 サンプル・テンプレート
- プロンプトテンプレート集
- 記事構成テンプレート
- カスタマイズ例

### 9.3 コミュニティ
- GitHubリポジトリ（オープンソース）
- Issues での質問受付
- Wiki での情報共有